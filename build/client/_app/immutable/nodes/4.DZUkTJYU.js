var Wt=Object.defineProperty;var wt=s=>{throw TypeError(s)};var Dt=(s,t,e)=>t in s?Wt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var z=(s,t,e)=>Dt(s,typeof t!="symbol"?t+"":t,e),Yt=(s,t,e)=>t.has(s)||wt("Cannot "+e);var _=(s,t,e)=>(Yt(s,t,"read from private field"),e?e.call(s):t.get(s)),W=(s,t,e)=>t.has(s)?wt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import{f as m,a as c,c as tt}from"../chunks/CMtbTKJu.js";import{o as Ht,a as Ft}from"../chunks/DiSFl9ii.js";import{q as K,g as a,s as Q,aD as zt,k as Kt,o as Qt,aE as Vt,b as v,f as l,$ as Zt,i,j as x,W as q,aF as te}from"../chunks/7FY0L4vI.js";import{d as ee,s as w}from"../chunks/Du9CEb0K.js";import{e as et,i as at,s as Lt}from"../chunks/Chx5TUuH.js";import{i as b}from"../chunks/CLUD8Wi6.js";import{h as ae,r as Bt,s as dt}from"../chunks/Bqn2R7Ah.js";import{b as Ot}from"../chunks/DUrCNlHf.js";import{s as se,a as ne}from"../chunks/M-cTPy3Q.js";import{s as oe}from"../chunks/DW6WyBD6.js";const re=()=>{const s=oe;return{page:{subscribe:s.page.subscribe},navigating:{subscribe:s.navigating.subscribe},updated:s.updated}},ie={subscribe(s){return re().page.subscribe(s)}};var st,nt,ot,rt;class ce{constructor(t,e,h){z(this,"socket",null);z(this,"reconnectAttempts",0);z(this,"maxReconnectAttempts",10);W(this,st,K(!1));W(this,nt,K(null));W(this,ot,K(null));W(this,rt,K(zt([])));this.gameType=t,this.roomCode=e,this.onEvent=h}get connected(){return a(_(this,st))}set connected(t){Q(_(this,st),t,!0)}get error(){return a(_(this,nt))}set error(t){Q(_(this,nt),t,!0)}get gameState(){return a(_(this,ot))}set gameState(t){Q(_(this,ot),t,!0)}get eventLog(){return a(_(this,rt))}set eventLog(t){Q(_(this,rt),t,!0)}connect(){const t=`wss://${window.location.host}/ws/${this.gameType}/${this.roomCode}`;this.socket=new WebSocket(t),this.socket.addEventListener("open",()=>{this.connected=!0,this.error=null,this.reconnectAttempts=0,this.addToLog("Connected to game")}),this.socket.addEventListener("message",e=>{const h=JSON.parse(e.data);switch(h.type){case"gamestate":this.gameState=h.data;break;case"event":this.onEvent(h.event);break;case"error":this.error=h.message,this.addToLog(`Error: ${h.message}`);break}}),this.socket.addEventListener("close",()=>{if(this.connected=!1,this.addToLog("Disconnected from game"),this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),1e4);setTimeout(()=>this.connect(),e)}}),this.socket.addEventListener("error",e=>{console.error("WebSocket error:",e),this.error="Connection error"})}sendAction(t){if(!this.socket||!this.connected){console.warn("Cannot send action: not connected");return}this.socket.send(JSON.stringify({type:"action",action:t}))}disconnect(){this.socket&&(this.socket.close(),this.socket=null)}addToLog(t){this.eventLog=[...this.eventLog,t]}}st=new WeakMap,nt=new WeakMap,ot=new WeakMap,rt=new WeakMap;var u=(s=>(s.X="X",s.O="O",s.None="[none]",s))(u||{}),vt=(s=>(s.Nominating="nominating",s.Bidding="bidding",s.None="none",s))(vt||{});function de(s){return s===u.X?u.O:u.X}var it,ct;class ve{constructor(t){z(this,"connection");W(this,it,K(null));W(this,ct,K(null));z(this,"timerInterval",null);this.connection=new ce("auction-ttt",t,e=>this.applyEvent(e))}get currentBid(){return a(_(this,it))}set currentBid(t){Q(_(this,it),t,!0)}get nominating(){return a(_(this,ct))}set nominating(t){Q(_(this,ct),t,!0)}get state(){return this.connection.gameState}get connected(){return this.connection.connected}get eventLog(){return this.connection.eventLog}get myPlayer(){if(!this.state||this.state.gameStage==="pregame")return null;const t=this.state.pov;return this.state.players.X.controller===t?this.state.players.X:this.state.players.O.controller===t?this.state.players.O:null}get mySide(){if(!this.state)return u.None;const t=this.state.pov;return this.state.players.X.controller===t?u.X:this.state.players.O.controller===t?u.O:u.None}get isMyTurn(){if(!this.state||this.state.gameStage!=="midgame")return!1;const t=this.mySide;return t===u.None?!1:this.state.turnPart===vt.Nominating?this.state.whoseTurnToNominate===t:this.state.turnPart===vt.Bidding?this.state.whoseTurnToBid===t:!1}connect(){this.connection.connect()}disconnect(){this.connection.disconnect(),this.stopTimer()}sendAction(t){this.connection.sendAction(t)}applyEvent(t){const e=this.state;if(e)switch(t.type){case"changeRoomSettings":e.roomName=t.roomName,e.isPublic=t.isPublic;break;case"changeHost":e.host=t.host,t.host===e.pov&&this.connection.addToLog("You are now the host");break;case"changeGameSettings":e.gameStage==="pregame"&&(e.settings=t.settings);break;case"join":e.players[t.side].controller=t.controller,this.connection.addToLog(`A player has joined as ${t.side}`),e.gameStage==="midgame"&&e.lastBid!==void 0&&(this.currentBid=e.lastBid+1);break;case"leave":delete e.players[t.side].controller,this.connection.addToLog(`The player playing ${t.side} has left`);break;case"start":e.gameStage==="pregame"?this.connection.addToLog("The game has started"):this.connection.addToLog("A new game has started");break;case"timing":e.gameStage==="midgame"&&(e.players.X.timeUsed=t.X,e.players.O.timeUsed=t.O,e.timeOfLastMove=t.timeOfLastMove);break;case"nominate":if(e.gameStage==="midgame"){const h=e.whoseTurnToNominate;this.connection.addToLog(`${h} nominated a square with a starting bid of $${t.startingBid}`),this.nominating=null,this.currentBid=t.startingBid+1}break;case"bid":if(e.gameStage==="midgame"&&e.whoseTurnToBid){const h=de(e.whoseTurnToBid);this.connection.addToLog(`${h} bid $${t.amount}`),this.currentBid=t.amount+1}break;case"pass":e.gameStage==="midgame"&&e.whoseTurnToBid&&this.connection.addToLog(`${e.whoseTurnToBid} passed`);break;case"awardSquare":e.gameStage==="midgame"&&this.connection.addToLog(`The square has been awarded to ${t.side}`);break;case"gameOver":t.winningSide===u.None?this.connection.addToLog("The game is a tie!"):this.connection.addToLog(`${t.winningSide} has won the game!`),this.stopTimer();break;case"backToSettings":this.connection.addToLog("Returning to settings");break}}startTimer(){this.timerInterval||(this.timerInterval=setInterval(()=>{const t=this.state;if(!t||t.gameStage!=="midgame"||!t.timeOfLastMove)return;const e=Date.now(),h=e-t.timeOfLastMove,V=t.turnPart===vt.Bidding?t.whoseTurnToBid:t.whoseTurnToNominate;V&&t.players[V].timeUsed!==void 0&&(t.players[V].timeUsed+=h,t.timeOfLastMove=e)},1e3))}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}}it=new WeakMap,ct=new WeakMap;var le=m("<p> </p>"),me=m("<p>Loading game state...</p>"),ue=m("<button>Leave</button>"),ge=m("<p>Joined</p> <!>",1),he=m("<button>Join as X</button>"),pe=m("<button>Leave</button>"),fe=m("<p>Joined</p> <!>",1),_e=m("<button>Join as O</button>"),be=m("<button>Start Game</button>"),ye=m('<div class="pregame"><h2>Waiting to start...</h2> <div class="player-select svelte-1y3eif9"><div class="svelte-1y3eif9"><h3>Player X</h3> <!></div> <div class="svelte-1y3eif9"><h3>Player O</h3> <!></div></div> <!></div>'),Te=m("<button> </button>"),ke=m('<div class="bidding svelte-1y3eif9"><p> </p> <input type="number" class="svelte-1y3eif9"/> <button>Bid</button> <button>Pass</button></div>'),Se=m('<div class="nominating svelte-1y3eif9"><p>Your turn to nominate a square</p> <label>Starting bid: $ <input type="number" class="svelte-1y3eif9"/></label></div>'),we=m("<p>Waiting for opponent...</p>"),Le=m('<div class="midgame"><div class="players-info svelte-1y3eif9"><div><h3>Player X</h3> <p> </p></div> <div><h3>Player O</h3> <p> </p></div></div> <div class="board svelte-1y3eif9"></div> <!></div>'),Be=m("<p>It's a tie!</p>"),Oe=m("<p> </p>"),Ae=m("<div> </div>"),Xe=m("<button>Rematch</button>"),$e=m('<div class="postgame"><h2>Game Over!</h2> <!> <div class="board svelte-1y3eif9"></div> <!></div>'),Ne=m('<li class="svelte-1y3eif9"> </li>'),xe=m('<div class="room-info svelte-1y3eif9"><p> </p> <p> </p> <p> </p></div> <!> <div class="event-log svelte-1y3eif9"><h3>Event Log</h3> <ul class="svelte-1y3eif9"></ul></div>',1),Me=m('<div class="game-container svelte-1y3eif9"><h1>Auction Tic-Tac-Toe</h1> <!></div>');function De(s,t){Kt(t,!0);const e=()=>se(ie,"$page",h),[h,V]=ne(),lt=e().params.roomCode.toUpperCase(),o=new ve(lt);Ht(()=>{o.connect()}),Ft(()=>{o.disconnect()});function ft(y){o.sendAction({type:"join",side:y})}function _t(){o.sendAction({type:"leave"})}function At(){o.sendAction({type:"start"})}function Xt(y,M){if(!o.state||o.state.gameStage!=="midgame")return;const Z=o.currentBid||0;o.sendAction({type:"nominate",square:[y,M],startingBid:Z}),o.currentBid=null}function $t(){o.currentBid!==null&&o.sendAction({type:"bid",amount:o.currentBid})}function Nt(){o.sendAction({type:"pass"})}function xt(){o.sendAction({type:"rematch"})}var mt=Me();ae("1y3eif9",y=>{Vt(()=>{Zt.title=`Auction Tic-Tac-Toe | ${lt??""}`})});var Mt=v(l(mt),2);{var Pt=y=>{var M=le(),Z=l(M);i(M),x(()=>w(Z,`Connecting to room ${lt??""}...`)),c(y,M)},Ct=y=>{var M=tt(),Z=q(M);{var Et=D=>{var d=me();c(D,d)},It=D=>{const d=te(()=>o.state);var bt=xe(),ut=q(bt),gt=l(ut),qt=l(gt);i(gt);var ht=v(gt,2),Gt=l(ht);i(ht);var yt=v(ht,2),Jt=l(yt);i(yt),i(ut);var Tt=v(ut,2);{var Rt=P=>{var C=ye(),O=v(l(C),2),G=l(O),pt=v(l(G),2);{var E=n=>{var r=ge(),L=v(q(r),2);{var U=T=>{var g=ue();g.__click=_t,c(T,g)};b(L,T=>{o.mySide===u.X&&T(U)})}c(n,r)},A=n=>{var r=he();r.__click=()=>ft(u.X),c(n,r)};b(pt,n=>{a(d).players.X.controller!==void 0?n(E):n(A,!1)})}i(G);var X=v(G,2),J=v(l(X),2);{var Y=n=>{var r=fe(),L=v(q(r),2);{var U=T=>{var g=pe();g.__click=_t,c(T,g)};b(L,T=>{o.mySide===u.O&&T(U)})}c(n,r)},R=n=>{var r=_e();r.__click=()=>ft(u.O),c(n,r)};b(J,n=>{a(d).players.O.controller!==void 0?n(Y):n(R,!1)})}i(X),i(O);var H=v(O,2);{var F=n=>{var r=be();r.__click=At,c(n,r)};b(H,n=>{a(d).pov===a(d).host&&a(d).players.X.controller!==void 0&&a(d).players.O.controller!==void 0&&n(F)})}i(C),c(P,C)},Ut=P=>{var C=tt(),O=q(C);{var G=E=>{var A=Le(),X=l(A),J=l(X),Y=v(l(J),2),R=l(Y);i(Y),i(J);var H=v(J,2),F=v(l(H),2),n=l(F);i(F),i(H),i(X);var r=v(X,2);et(r,21,()=>a(d).squares,at,(g,p,B)=>{var I=tt(),$=q(I);et($,17,()=>a(p),at,(k,f,N)=>{var S=Te();let j;S.__click=()=>Xt(B,N);var jt=l(S,!0);i(S),x(()=>{j=Lt(S,1,"square svelte-1y3eif9",null,j,{X:a(f)===u.X,O:a(f)===u.O}),S.disabled=a(f)!==u.None||!o.isMyTurn||a(d).turnPart!=="nominating",w(jt,a(f)===u.None?"":a(f))}),c(k,S)}),c(g,I)}),i(r);var L=v(r,2);{var U=g=>{var p=ke(),B=l(p),I=l(B);i(B);var $=v(B,2);Bt($);var k=v($,2);k.__click=$t;var f=v(k,2);f.__click=Nt,i(p),x(()=>{var N;w(I,`Current bid: $${a(d).lastBid??""}`),dt($,"min",a(d).lastBid+1),dt($,"max",((N=o.myPlayer)==null?void 0:N.money)||0)}),Ot($,()=>o.currentBid,N=>o.currentBid=N),c(g,p)},T=g=>{var p=tt(),B=q(p);{var I=k=>{var f=Se(),N=v(l(f),2),S=v(l(N));Bt(S),dt(S,"min",0),i(N),i(f),x(()=>{var j;return dt(S,"max",((j=o.myPlayer)==null?void 0:j.money)||0)}),Ot(S,()=>o.currentBid,j=>o.currentBid=j),c(k,f)},$=k=>{var f=we();c(k,f)};b(B,k=>{a(d).turnPart==="nominating"&&o.isMyTurn?k(I):k($,!1)},!0)}c(g,p)};b(L,g=>{a(d).turnPart==="bidding"&&o.isMyTurn?g(U):g(T,!1)})}i(A),x(()=>{w(R,`Money: $${a(d).players.X.money??""}`),w(n,`Money: $${a(d).players.O.money??""}`)}),c(E,A)},pt=E=>{var A=$e(),X=v(l(A),2);{var J=n=>{var r=Be();c(n,r)},Y=n=>{var r=Oe(),L=l(r);i(r),x(()=>w(L,`${a(d).winner.winningSide??""} wins!`)),c(n,r)};b(X,n=>{a(d).winner.winningSide===u.None?n(J):n(Y,!1)})}var R=v(X,2);et(R,21,()=>a(d).squares,at,(n,r)=>{var L=tt(),U=q(L);et(U,17,()=>a(r),at,(T,g)=>{var p=Ae();let B;var I=l(p,!0);i(p),x(()=>{B=Lt(p,1,"square svelte-1y3eif9",null,B,{X:a(g)===u.X,O:a(g)===u.O}),w(I,a(g)===u.None?"":a(g))}),c(T,p)}),c(n,L)}),i(R);var H=v(R,2);{var F=n=>{var r=Xe();r.__click=xt,c(n,r)};b(H,n=>{a(d).pov===a(d).host&&n(F)})}i(A),c(E,A)};b(O,E=>{a(d).gameStage==="midgame"?E(G):E(pt,!1)},!0)}c(P,C)};b(Tt,P=>{a(d).gameStage==="pregame"?P(Rt):P(Ut,!1)})}var kt=v(Tt,2),St=v(l(kt),2);et(St,21,()=>o.eventLog,at,(P,C)=>{var O=Ne(),G=l(O,!0);i(O),x(()=>w(G,a(C))),c(P,O)}),i(St),i(kt),x(()=>{w(qt,`Room: ${a(d).roomName??""} (${a(d).roomCode??""})`),w(Gt,`You are: ${a(d).pov===a(d).host?"Host":"Guest"}`),w(Jt,`Your side: ${o.mySide??""}`)}),c(D,bt)};b(Z,D=>{o.state?D(It,!1):D(Et)},!0)}c(y,M)};b(Mt,y=>{o.connected?y(Ct,!1):y(Pt)})}i(mt),c(s,mt),Qt(),V()}ee(["click"]);export{De as component};
