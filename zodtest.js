import { z } from "zod";

const league = {
  "type": "import",
  "gameStage": "draft",
  "teams": [
    {
      "controller": "bot",
      "name": "Unusual Wombats",
      "money": 100,
      "fighters": [
        {
          "name": "Barbie Sliceblade",
          "gender": "F",
          "price": 0,
          "abilities": {},
          "stats": {
            "strength": 5,
            "accuracy": 1,
            "energy": 3,
            "speed": 0,
            "toughness": 4
          },
          "attunements": [],
          "experience": 0,
          "description": "",
          "flavor": "",
          "appearance": {
            "body": "/static/base/body_F1.png",
            "hair": "/static/base/hair_F4.png",
            "face": "/static/base/face_2.png",
            "shirt": "/static/base/shirt_F1.png",
            "shorts": "/static/base/shorts_F1.png",
            "socks": "/static/base/socks_F1.png",
            "shoes": "/static/base/shoes_F1.png",
            "hairColor": [
              [
                83,
                38,
                34
              ],
              [
                0.8,
                0.3
              ]
            ],
            "skinColor": [
              [
                90,
                15,
                10
              ],
              [
                0.5,
                0.8
              ]
            ],
            "shirtColor": [
              [
                176,
                6,
                15
              ],
              [
                0,
                0.7,
                1
              ]
            ],
            "shortsColor": [
              [
                3,
                47,
                86
              ],
              [
                200,
                0.5,
                1
              ]
            ],
            "shoesColor": [
              [
                21,
                43,
                62
              ],
              [
                200,
                0.5,
                0.5
              ]
            ]
          }
        }
      ],
      "equipment": [],
      "needsResigning": [],
      "needsRepair": []
    },
    {
      "controller": "bot",
      "name": "Courageous Sprites",
      "money": 100,
      "fighters": [
        {
          "name": "Lindsay Pennywise",
          "gender": "F",
          "price": 0,
          "abilities": {},
          "stats": {
            "strength": 5,
            "accuracy": 3,
            "energy": 5,
            "speed": 2,
            "toughness": 2
          },
          "attunements": [],
          "experience": 0,
          "description": "",
          "flavor": "",
          "appearance": {
            "body": "/static/base/body_F1.png",
            "hair": "/static/base/hair_F4.png",
            "face": "/static/base/face_2.png",
            "shirt": "/static/base/shirt_F2.png",
            "shorts": "/static/base/shorts_F1.png",
            "socks": "/static/base/socks_F1.png",
            "shoes": "/static/base/shoes_F1.png",
            "hairColor": [
              [
                167,
                62,
                46
              ],
              [
                2,
                0.5
              ]
            ],
            "skinColor": [
              [
                163,
                54,
                43
              ],
              [
                1.5,
                0.5
              ]
            ],
            "shirtColor": [
              [
                3,
                55,
                4
              ],
              [
                120,
                0.5,
                1
              ]
            ],
            "shortsColor": [
              [
                5,
                11,
                30
              ],
              [
                240,
                2,
                0.5
              ]
            ],
            "shoesColor": [
              [
                91,
                31,
                31
              ],
              [
                0,
                0.8,
                0.3
              ]
            ]
          }
        }
      ],
      "equipment": [],
      "needsResigning": [],
      "needsRepair": []
    },
    {
      "controller": "bot",
      "name": "Healthy Birds",
      "money": 100,
      "fighters": [],
      "equipment": [],
      "needsResigning": [],
      "needsRepair": []
    }
  ],
  "history": [],
  "settings": {
    "customFighters": [],
    "customEquipment": []
  },
  "draftOrder": [
    0,
    1,
    2
  ],
  "spotInDraftOrder": 2,
  "fighters": [
    {
      "name": "Epiphania Nguyen",
      "gender": "A",
      "price": 0,
      "abilities": {},
      "stats": {
        "strength": 2,
        "accuracy": 0,
        "energy": 6,
        "speed": 1,
        "toughness": 7
      },
      "attunements": [],
      "experience": 0,
      "description": "",
      "flavor": "",
      "appearance": {
        "body": "/static/base/body_A1.png",
        "hair": "/static/base/hair_A2.png",
        "face": "/static/base/face_2.png",
        "shirt": "/static/base/shirt_A1.png",
        "shorts": "/static/base/shorts_A1.png",
        "socks": "/static/base/socks_A1.png",
        "shoes": "/static/base/shoes_A1.png",
        "hairColor": [
          [
            139,
            123,
            114
          ],
          [
            5,
            0.1
          ]
        ],
        "skinColor": [
          [
            188,
            113,
            68
          ],
          [
            5,
            0.5
          ]
        ],
        "shirtColor": [
          [
            176,
            6,
            15
          ],
          [
            0,
            0.7,
            1
          ]
        ],
        "shortsColor": [
          [
            1,
            14,
            89
          ],
          [
            240,
            0.2,
            2
          ]
        ],
        "shoesColor": [
          [
            0,
            0,
            0
          ],
          [
            0,
            0,
            1
          ]
        ]
      }
    },
    {
      "name": "Veronica Soto",
      "gender": "F",
      "price": 0,
      "abilities": {},
      "stats": {
        "strength": 2,
        "accuracy": 3,
        "energy": 2,
        "speed": 1,
        "toughness": 8
      },
      "attunements": [],
      "experience": 0,
      "description": "",
      "flavor": "",
      "appearance": {
        "body": "/static/base/body_F1.png",
        "hair": "/static/base/hair_F3.png",
        "face": "/static/base/face_2.png",
        "shirt": "/static/base/shirt_F1.png",
        "shorts": "/static/base/shorts_F1.png",
        "socks": "/static/base/socks_F1.png",
        "shoes": "/static/base/shoes_F1.png",
        "hairColor": [
          [
            7,
            6,
            5
          ],
          [
            0.1,
            0.1
          ]
        ],
        "skinColor": [
          [
            188,
            113,
            68
          ],
          [
            5,
            0.5
          ]
        ],
        "shirtColor": [
          [
            5,
            11,
            30
          ],
          [
            240,
            2,
            0.5
          ]
        ],
        "shortsColor": [
          [
            1,
            14,
            89
          ],
          [
            240,
            0.2,
            2
          ]
        ],
        "shoesColor": [
          [
            91,
            31,
            31
          ],
          [
            0,
            0.8,
            0.3
          ]
        ]
      }
    },
    {
      "name": "Rudy Laplace",
      "gender": "M",
      "price": 0,
      "abilities": {},
      "stats": {
        "strength": 3,
        "accuracy": 3,
        "energy": 0,
        "speed": 2,
        "toughness": 4
      },
      "attunements": [],
      "experience": 0,
      "description": "",
      "flavor": "",
      "appearance": {
        "body": "/static/base/body_M1.png",
        "hair": "/static/base/hair_M4.png",
        "face": "/static/base/face_1.png",
        "shirt": "/static/base/shirt_M1.png",
        "shorts": "/static/base/shorts_M1.png",
        "socks": "/static/base/socks_M1.png",
        "shoes": "/static/base/shoes_M1.png",
        "hairColor": [
          [
            90,
            15,
            10
          ],
          [
            0.5,
            0.8
          ]
        ],
        "skinColor": [
          [
            150,
            37,
            30
          ],
          [
            1,
            0.6
          ]
        ],
        "shirtColor": [
          [
            54,
            54,
            54
          ],
          [
            0,
            10,
            0
          ]
        ],
        "shortsColor": [
          [
            5,
            11,
            30
          ],
          [
            240,
            2,
            0.5
          ]
        ],
        "shoesColor": [
          [
            21,
            43,
            62
          ],
          [
            200,
            0.5,
            0.5
          ]
        ]
      }
    },
    {
      "name": "Rona Mullins",
      "gender": "F",
      "price": 0,
      "abilities": {},
      "stats": {
        "strength": 3,
        "accuracy": 2,
        "energy": 3,
        "speed": 3,
        "toughness": 1
      },
      "attunements": [],
      "experience": 0,
      "description": "",
      "flavor": "",
      "appearance": {
        "body": "/static/base/body_F1.png",
        "hair": "/static/base/hair_F3.png",
        "face": "/static/base/face_2.png",
        "shirt": "/static/base/shirt_F1.png",
        "shorts": "/static/base/shorts_F1.png",
        "socks": "/static/base/socks_F1.png",
        "shoes": "/static/base/shoes_F1.png",
        "hairColor": [
          [
            83,
            38,
            34
          ],
          [
            0.8,
            0.3
          ]
        ],
        "skinColor": [
          [
            163,
            54,
            43
          ],
          [
            1.5,
            0.5
          ]
        ],
        "shirtColor": [
          [
            5,
            11,
            30
          ],
          [
            240,
            2,
            0.5
          ]
        ],
        "shortsColor": [
          [
            252,
            13,
            27
          ],
          [
            0,
            10,
            1
          ]
        ],
        "shoesColor": [
          [
            0,
            0,
            0
          ],
          [
            0,
            0,
            1
          ]
        ]
      }
    },
    {
      "name": "Kei Ultra",
      "gender": "F",
      "price": 0,
      "abilities": {},
      "stats": {
        "strength": 0,
        "accuracy": 1,
        "energy": 0,
        "speed": 2,
        "toughness": 0
      },
      "attunements": [],
      "experience": 0,
      "description": "",
      "flavor": "",
      "appearance": {
        "body": "/static/base/body_F1.png",
        "hair": "/static/base/hair_F1.png",
        "face": "/static/base/face_1.png",
        "shirt": "/static/base/shirt_F1.png",
        "shorts": "/static/base/shorts_F1.png",
        "socks": "/static/base/socks_F1.png",
        "shoes": "/static/base/shoes_F1.png",
        "hairColor": [
          [
            90,
            15,
            10
          ],
          [
            0.5,
            0.8
          ]
        ],
        "skinColor": [
          [
            150,
            37,
            30
          ],
          [
            1,
            0.6
          ]
        ],
        "shirtColor": [
          [
            0,
            0,
            0
          ],
          [
            0,
            0,
            1
          ]
        ],
        "shortsColor": [
          [
            0,
            0,
            0
          ],
          [
            0,
            0,
            1
          ]
        ],
        "shoesColor": [
          [
            5,
            11,
            30
          ],
          [
            240,
            0.2,
            0.5
          ]
        ]
      }
    }
  ],
  "unsignedVeterans": []
};


const trigger = z.literal("");
const target = z.literal("");
const actionAnimation = z.literal("");
const equipmentSlot = z.literal("");

const hpChangeEffect = z.object({
    type: z.literal("hpChange"),
    amount: z.number().int()
  });
  
const damageEffect = z.object({
  type: z.literal("damage"),
  amount: z.number()
});

const statName = z.union(
  z.literal("strength"),
  z.literal("speed"),
  z.literal("toughness"),
  z.literal("energy"),
  z.literal("accuracy"),
)

const statChangeEffect = z.object({
  type: z.literal("statChange"),
  stat: statName,
  amount: z.number().int(),
  duration: z.number(),
  tint: z.array(z.number()).length(4).optional()
});

const effect = z.union([hpChangeEffect, damageEffect, statChangeEffect]);

const actionAbility = z.object({
  target: target,
  effects: z.array(effect),
  cooldown: z.number().min(0),
  chargeNeeded: z.number().int().min(1).optional(),
  dodgeable: z.boolean().optional(),
  missable: z.boolean().optional(),
  animation: actionAnimation.optional(),
  projectileImg: z.string().optional(),
  knockback: z.number().optional()
});

const statChangeAbility = z.object({
  stat: statName,
  amount: z.number()
});

const triggeredEffect = z.intersection(
  effect,
  z.object({
    trigger: trigger,
    target: target
  })
);

const aiHints = z.object({
  actionDanger: z.number().optional(),
  actionStat: statName.optional(),
  passiveDanger: z.number().optional(),
  passiveValue: z.number().optional(),
  teammateMultiplier: z.boolean().optional()
});

const abilities = z.object({
  action: actionAbility.optional(),
  statChanges: z.array(statChangeAbility).optional(),
  triggeredEffects: z.array(triggeredEffect).optional(),
  aiHints: aiHints.optional()
});

const fighterTemplateSchema = z.object({
  imgUrl: z.string().max(300),
  abilities: abilities,
  price: z.number().min(0).max(100).int(),
  description: z.string().max(300),
  flavor: z.string().max(300)
});

const equipmentTemplateSchema = z.object({
  name: z.string().min(1).max(100),
  imgUrl: z.string().max(300),
  slots: z.array(equipmentSlot),
  abilities: z.array(abilities),
  price: z.number().min(0).max(100).int(),
  description: z.string().max(300),
  flavor: z.string().max(300)
});

const settingsSchema = z.object({
  customFighters: z.array(fighterTemplateSchema),
  customEquipment: z.array(equipmentTemplateSchema),
});

const changeGameSettingsSchema = z.object({
  type: z.literal("changeGameSettings"),
  settings: settingsSchema
});

const colorSchema = z.tuple([
  z.array(z.number()).length(3),
  z.array(z.number()).min(2).max(3)
]);

const fighterSchema = z.object({
  name: z.string(),
  gender: z.union([z.literal("M"), z.literal("F"), z.literal("A")]),
  stats: z.object({
    strength: z.number().int().min(0).max(10),
    accuracy: z.number().int().min(0).max(10),
    energy: z.number().int().min(0).max(10),
    speed: z.number().int().min(0).max(10),
    toughness: z.number().int().min(0).max(10)
  }),
  attunements: z.array(z.string()),
  abilities: abilities,
  experience: z.number().int().min(0),
  price: z.number().int(),
  description: z.string(),
  flavor: z.string(),
  appearance: z.object({
    body: z.string(),
    hair: z.string(),
    face: z.string(),
    shirt: z.string(),
    shorts: z.string(),
    socks: z.string(),
    shoes: z.string(),
    hairColor: colorSchema,
    skinColor: colorSchema,
    shirtColor: colorSchema,
    shortsColor: colorSchema,
    shoesColor: colorSchema
  })
});

const equipmentSchema = z.object({
  name: z.string(),
  imgUrl: z.string(),
  zoomedImgUrl: z.string(),
  slots: z.array(equipmentSlot),
  abilities: abilities,
  yearsOwned: z.number().int().min(0),
  price: z.number().int(),
  description: z.string(),
  flavor: z.string()
});

const teamSchema = z.object({
  name: z.string(),
  money: z.number().int().min(0),
  fighters: z.array(fighterSchema),
  equipment: z.array(equipmentSchema)
});

const preseasonTeamSchema = z.intersection(
  teamSchema,
  z.object({
    needsResigning: z.array(fighterSchema),
    needsRepair: z.array(equipmentSchema)
  })
);

const preseasonImportSchema = z.object({
  gameStage: z.literal("preseason"),
  teams: z.array(preseasonTeamSchema).max(16)
});
  
const draftExportSchema = z.object({
  gameStage: z.literal("draft"),
  draftOrder: z.array(z.number().int().min(0).max(15)).max(16),
  spotInDraftOrder: z.number().int().min(0).max(15),
  fighters: z.array(fighterSchema).min(5),
  unsignedVeterans: z.array(fighterSchema)
});

const faExportSchema = z.object({
  gameStage: z.literal("free agency"),
  draftOrder: z.array(z.number().int().min(0).max(15)).min(2).max(16),
  spotInDraftOrder: z.number().int().min(0).max(15),
  fighters: z.array(fighterSchema).min(5),
});

const trainingExportSchema = z.object({
  gameStage: z.literal("training"),
  equipmentAvailable: z.array(z.array(equipmentSchema).length(8)).min(2).max(16)
});

const brExportSchema = z.object({
  gameStage: z.literal("battle royale")
});

const tournamentExportSchema = z.object({
  gameStage: z.literal("tournament"),
  bracketOrdering: z.array(z.number().min(0).max(15)).min(2).max(16)
});

const exportBase = z.object({
  type: z.literal("import"),
  settings: settingsSchema,
  // history: z.array(z.array(z.string()).min(2).max(16)),
  teams: z.array(teamSchema)
});

const importSchema = z.intersection(
  exportBase,
  z.union([
    preseasonImportSchema, draftExportSchema, faExportSchema,
    trainingExportSchema, brExportSchema, tournamentExportSchema
  ])
);

exportBase.parse(league);